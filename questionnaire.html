<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Questionnaire | RS Digital</title>
    <meta name="description" content="Client questionnaire for new web design projects with RS Digital.">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    
    <style>
        /* ... Your existing CSS styles ... */
        /* ==========================================================================
           RS Digital - Main Stylesheet (Copied for consistent styling)
           ========================================================================== */

        /* --- CSS Variables (Dark Theme) --- */
        :root {
            --bg-color: #0a192f;
            --nav-bg-color: rgba(10, 25, 47, 0.85);
            --card-bg-color: #112240;
            --border-color: #233554;
            --heading-color: #ccd6f6;
            --text-color: #8892b0;
            --light-text-color: #a8b2d1;
            --accent-color: #64ffda;
            --accent-hover-color: rgba(100, 255, 218, 0.1);
            --button-text-color: #0a192f;
            --shadow-color: rgba(2,12,27,0.7);
            --logo-secondary-color: #FF4136; /* Red for the 'S' */

            --font-family: 'Poppins', sans-serif;
            --header-height: 70px;
        }

        /* --- CSS Variables (Light Theme) --- */
        body.light-mode {
            --bg-color: #F7F9FC;
            --nav-bg-color: rgba(255, 255, 255, 0.85);
            --card-bg-color: #FFFFFF;
            --border-color: #e0e0e0;
            --heading-color: #1A2A4C;
            --text-color: #555555;
            --light-text-color: #333333;
            --accent-color: #007BFF;
            --accent-hover-color: rgba(0, 123, 255, 0.1);
            --button-text-color: #FFFFFF;
            --shadow-color: rgba(0,0,0,0.05);
            --logo-secondary-color: #FF4136; /* Red for the 'S' */
        }

        /* --- General Setup & Base Styles --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
            scroll-padding-top: var(--header-height);
        }

        body {
            font-family: var(--font-family);
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--bg-color);
            /* Add background image */
            background-image: linear-gradient(rgba(10, 25, 47, 0.8), rgba(10, 25, 47, 0.8)), url('assets/dark-background.jpg');
            background-size: cover;
            background-position: center center;
            background-attachment: fixed;
            transition: background-color 0.3s ease, color 0.3s ease;
        }
        
        body.light-mode {
             background-image: url('assets/light-background.jpg');
        }

        /* --- Utility Classes & Reusable Components --- */
        .container {
            max-width: 1100px;
            margin: 0 auto;
            padding: 0 20px;
        }

        section {
            padding: 60px 0;
            background-color: transparent; 
        }

        h1, h2, h3, h4 {
            line-height: 1.2;
            margin-bottom: 20px;
            color: var(--heading-color);
        }

        h1 { font-size: 2.5rem; }
        h2 { font-size: 2rem; text-align: center; }
        h3 { font-size: 1.5rem; }
        h4 { font-size: 1.2rem; color: var(--accent-color); margin-top: 30px; }


        p {
            margin-bottom: 15px;
            color: var(--text-color);
        }

        ul { list-style: none; }
        a { text-decoration: none; color: var(--accent-color); }

        .subtitle {
            font-size: 1.1rem;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            text-align: center;
            color: var(--light-text-color);
        }

        /* --- Buttons --- */
        .btn {
            display: inline-block;
            padding: 12px 24px;
            border-radius: 5px;
            font-weight: bold;
            font-size: 1rem;
            text-align: center;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            cursor: pointer; /* Ensure button cursor */
        }
        
        .btn:disabled {
            background-color: var(--text-color);
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-primary {
            background-color: var(--accent-color);
            color: var(--button-text-color);
        }
        .btn-primary:hover:not(:disabled) {
            opacity: 0.85;
        }
        
        /* ... other styles */
    </style>
</head>
<body>

    <header class="main-header">
        </header>

    <main>
        <section id="questionnaire" class="questionnaire-section">
            <div class="container">
                <h2>Project Questionnaire</h2>
                <p class="subtitle">Let's build something great together. Answering these questions will give me a clear idea of what you're looking for and help me prepare a tailored quote for you.</p>
                <div class="form-container">
                    <form id="project-questionnaire-form">
                        
                        <div class="form-section">
                            <h4>Section 1: The Selector</h4>
                            <div class="form-group">
                                <label>What type of website are you looking for?</label>
                                <div class="choice-group" id="site-type-selector">
                                    <label class="choice-label">
                                        <input type="radio" name="site-type" value="landing-page" checked> A "Digital Name Card" / Single-Page Landing Site
                                    </label>
                                    <label class="choice-label">
                                        <input type="radio" name="site-type" value="small-business"> A "Small Business" / Multi-Page Brochure Site
                                    </label>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h4>Section 5: Budget & Timeline</h4>
                             <div class="form-group">
                                <label>To help me suggest the best possible solution, what is your approximate budget for this project?</label>
                                <div class="choice-group">
                                    <label class="choice-label"><input type="radio" name="budget" value="<1000"> Under RM 1,000</label>
                                    <label class="choice-label"><input type="radio" name="budget" value="1000-2500"> RM 1,000 - RM 2,500</label>
                                    <label class="choice-label"><input type="radio" name="budget" value=">2500"> Over RM 2,500</label>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="q-deadline">Do you have a specific deadline for when you need the website to be live?</label>
                                <input type="text" id="q-deadline" name="deadline">
                            </div>
                        </div>

                        <button type="submit" id="submit-btn" class="btn btn-primary">Submit Questionnaire</button>
                    </form>
                </div>
            </div>
        </section>
    </main>

    <footer class="main-footer">
        </footer>

    <script type="module">
        import { checkAuthState, submitQuestionnaire } from './assets/auth.js';

        // --- Theme Management ---
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
        }

        // --- Page Protection & Form Handling ---
        const form = document.getElementById('project-questionnaire-form');
        const submitBtn = document.getElementById('submit-btn');
        let currentUser = null;

        checkAuthState(user => {
            if (user) {
                currentUser = user; // Store the authenticated user
            } else {
                // If no user, redirect (checkAuthState handles this, but good practice)
                window.location.href = '/login.html';
            }
        });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            if (!currentUser) {
                alert("You must be logged in to submit.");
                return;
            }

            submitBtn.disabled = true;
            submitBtn.textContent = 'Submitting...';

            // Create a data object from the form
            const formData = new FormData(form);
            const data = {};
            
            // Handle regular inputs
            for (let [key, value] of formData.entries()) {
                 // Handle checkboxes, which can have multiple values
                if (key.endsWith('[]')) {
                    const cleanKey = key.slice(0, -2);
                    if (!data[cleanKey]) {
                        data[cleanKey] = [];
                    }
                    data[cleanKey].push(value);
                } else {
                    data[key] = value;
                }
            }

            try {
                // Call the new function from auth.js
                await submitQuestionnaire(currentUser, data);
                // The function will handle redirection on success
            } catch (error) {
                alert(`Submission failed: ${error.message}`);
                submitBtn.disabled = false;
                submitBtn.textContent = 'Submit Questionnaire';
            }
        });


        // --- Conditional Form Logic ---
        const siteTypeSelector = document.getElementById('site-type-selector');
        const landingPageQuestions = document.getElementById('landing-page-questions');
        const smallBusinessQuestions = document.getElementById('small-business-questions');

        function toggleQuestionSections() {
            const selectedType = document.querySelector('input[name="site-type"]:checked').value;

            if (selectedType === 'landing-page') {
                landingPageQuestions.style.display = 'block';
                smallBusinessQuestions.style.display = 'none';
            } else if (selectedType === 'small-business') {
                landingPageQuestions.style.display = 'none';
                smallBusinessQuestions.style.display = 'block';
            }
        }
        
        if(siteTypeSelector) {
            toggleQuestionSections();
            siteTypeSelector.addEventListener('change', toggleQuestionSections);
        }
    </script>

</body>
</html>